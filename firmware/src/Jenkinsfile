pipeline {
    agent any

    stages {
        stage('Build Docker Image') {
            steps {
                script {
                    docker build -t mplab .('my-docker-image')
                }
            }
        }

        stage('Run Docker Container') {
            steps {
                script {
                    def containerId = docker run -itd -p 5050:5050 mplab('--rm', '-d', 'my-docker-image')
                    sh "docker cp $containerId:/var/lib/jenkins/workspace/mplab-cicd ./"
                }
            }
        }

        stage('Send Email') {
            steps {
                emailext (
                    to: 'ashokayewale2001@gmail.com',
                    subject: 'Docker Container Generated File',
                    body: 'Please find the attached file generated by the Docker container.',
                    attachmentsPattern: '*.hex'
                )
            }
        }
    }
}
